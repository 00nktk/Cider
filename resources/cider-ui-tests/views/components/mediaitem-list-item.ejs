<script type="text/x-template" id="mediaitem-list-item">
    <template>
        <div v-observe-visibility="{callback: visibilityChanged}"
             class="cd-mediaitem-list-item">
            <template v-if="isVisible">
                <div class="isLibrary" v-if="showLibraryStatus == true">
                    <button @click="addToLibrary()" v-if="!app.isInLibrary(item.attributes.playParams) && !addedToLibrary">üñ§</button>
                    <button v-else>‚ù§Ô∏è</button>
                </div>
                <div class="artwork" v-if="showArtwork == true">
                    <mediaitem-artwork
                            :url="item.attributes.artwork ? item.attributes.artwork.url : ''"
                            size="34"
                            :type="item.type"></mediaitem-artwork>
                </div>
                <div class="info-rect" :style="{'padding-left': (showArtwork ? '' : '16px')}" @click="playTrack()">
                    <div class="title text-overflow-elipsis">
                        {{ item.attributes.name }}
                    </div>
                    <div class="subtitle text-overflow-elipsis">
                        <template v-if="item.attributes.artistName">
                            {{ item.attributes.artistName }}
                            <template v-if="item.attributes.albumName">
                                - {{ item.attributes.albumName }}
                            </template>
                        </template>
                    </div>
                </div>
                <div class="content-rating" v-if="item.attributes.contentRating" @click="playTrack()">
                    {{ item.attributes.contentRating }}
                </div>
                <template v-if="showMetaData == true" @click="playTrack()">
                    <div class="metainfo">
                        {{ item.attributes.releaseDate ? new Date(item.attributes.releaseDate).toLocaleDateString()
                        : "" }}
                    </div>
                    <div class="metainfo">
                        {{ item.attributes.genreNames[0] ?? "" }}
                    </div>
                </template>
                <div class="duration" v-if="showDuration" @click="playTrack()">
                    {{ msToMinSec(item.attributes.durationInMillis ?? 0) }}
                </div>
            </template>
        </div>
    </template>
</script>

<script>
    Vue.component('mediaitem-list-item', {
        template: '#mediaitem-list-item',
        data: function () {
            return {
                isVisible: false,
                addedToLibrary: false
            }
        },
        props: {
            'item': {type: Object, required: true},
            'show-artwork': {type: Boolean, default: true},
            'show-library-status': {type: Boolean, default: true},
            'show-meta-data': {type: Boolean, default: false},
            'show-duration': {type: Boolean, default: true}
        },
        methods: {
            visibilityChanged: function (isVisible, entry) {
                this.isVisible = isVisible
            },
            addToLibrary() {
                let item = this.item
                if(item.attributes.playParams.id) {
                    console.log('adding to library', item.attributes.playParams.id)
                    app.addToLibrary(item.attributes.playParams.id.toString())
                    this.addedToLibrary = true
                }else if(item.id) {
                    console.log('adding to library', item.id)
                    app.addToLibrary(item.id.toString())
                    this.addedToLibrary = true
                }
            },
            playTrack() {
                let item = this.item
                app.playMediaItemById(item.attributes.playParams.id ?? item.id, item.attributes.playParams.kind ?? item.type, item.attributes.playParams.isLibrary ?? false, item.attributes.url)
            }
        }
    });
</script>